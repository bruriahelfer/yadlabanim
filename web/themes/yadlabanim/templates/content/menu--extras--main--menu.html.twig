{% import _self as menu %}

{{ menu.menu_links(items, attributes, 0, null) }}

{% macro menu_links(items, attributes, menu_level, parent_title) %}
  <ul{{attributes.addClass(['menu', 'menu-level-'~menu_level])}}>
    {% if menu_level == 1 and parent_title %}
      <div class="wrapper">
        <div class="close-menu"><img src="/themes/yadlabanim/images/close.svg" alt="Close Menu"></div>
        <li class="menu-parent-title">{{ parent_title }}</li>
    {% endif %}
    {% for key, item in items %}
      {% if key|first != '#' %}
        {% set menu_item_classes = [
          'menu-item',
          item.is_expanded ? 'menu-item--expanded',
          item.is_collapsed ? 'menu-item--collapsed',
          item.in_active_trail ? 'menu-item--active-trail',
          item.url.getRouteName() == '<nolink>' ? 'menu-item--nolink',
          item.content.field_class['#items'].value
        ] %}

        <li{{item.attributes.addClass(menu_item_classes)}}>
          {% set is_nolink = item.url.getRouteName() == '<nolink>' or (item.url.isExternal() and item.url.toString() == '') %}
          {% if is_nolink %}
            <span>{{ item.title }}</span>
            {{ item.content.field_subtitle }}
          {% else %}
            <a href="{{ item.url }}">
                <div class="title">{{ item.title }}</div>
                {{ item.content.field_subtitle }}
            </a>
          {% endif %}
          {% if item.below %}
            {{ menu.menu_links(item.below, attributes.removeClass(['menu', 'menu-level-'~menu_level]), menu_level + 1, item.title) }}
          {% endif %}
        </li>
      {% endif %}
    {% endfor %}
    {% if menu_level == 1 and parent_title %}
      </div>
    {% endif %}
  </ul>
{% endmacro %}